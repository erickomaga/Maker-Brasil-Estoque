<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Estoque - Maker Brasil</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'sans': ['Inter', 'sans-serif'],
            'display': ['Montserrat', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <style>
    body { background-color: #0f172a; color: #e2e8f0; }
    .hidden { display: none; }

    /* Estilos dos cards */
    .product-card, .edit-card {
      background-color: #1e293b;
      border-radius: 1rem;
      border: 1px solid #334155;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
      padding: 1.5rem;
      transition: all 0.3s ease;
    }
    .product-card:hover, .edit-card:hover {
      border-color: #3b82f6;
      transform: translateY(-4px);
    }

    .status-indicator, .status-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 9999px;
      padding: 0.4rem 0.8rem;
      font-weight: 700;
      font-size: 0.85rem;
      color: white;
    }
    .status-tranquilo, .bg-green-600 { background-color: #16a34a; }
    .status-alerta-fixo, .bg-yellow-400 { background-color: #f59e0b; color: #1e293b; }
    .status-preocupante, .bg-orange-500 { background-color: #f97316; }
    .status-vazio, .bg-red-600 { background-color: #dc2626; }
  </style>
</head>
<body class="font-sans antialiased pb-24">
  <header class="bg-slate-900/80 backdrop-blur-lg sticky top-0 z-50 shadow-lg shadow-black/30">
    <div class="container mx-auto max-w-7xl px-6 py-4 flex justify-between items-center">
      <h1 class="font-display text-3xl font-bold text-white">GestÃ£o de Estoque</h1>
      <nav class="flex items-center space-x-6">
        <button id="tab-visualizar" class="tab-btn text-gray-300 hover:text-blue-400 font-semibold">Visualizar Estoque</button>
        <button id="tab-editar" class="tab-btn text-gray-300 hover:text-blue-400 font-semibold">Editar Estoque</button>
      </nav>
    </div>
  </header>

  <!-- VISUALIZAR -->
  <main id="visualizar" class="container mx-auto max-w-7xl px-6 py-12">
    <section id="infantil-view" class="py-12">
      <h2 class="font-display text-4xl font-bold text-white border-b-2 border-blue-600 inline-block pb-2 mb-8">EducaÃ§Ã£o Infantil</h2>
      <div id="infantil-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </section>
    <section id="fundamental1-2-view" class="py-12">
      <h2 class="font-display text-4xl font-bold text-white border-b-2 border-blue-600 inline-block pb-2 mb-8">Fundamental I: 1Âº e 2Âº Ano</h2>
      <div id="fundamental1-2-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </section>
    <section id="fundamental3-5-view" class="py-12">
      <h2 class="font-display text-4xl font-bold text-white border-b-2 border-blue-600 inline-block pb-2 mb-8">Fundamental I: 3Âº ao 5Âº Ano</h2>
      <div id="fundamental3-5-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </section>
  </main>

  <!-- EDITAR -->
  <main id="editar" class="container mx-auto max-w-7xl px-6 py-12 hidden">
    <h2 class="font-display text-3xl font-semibold mb-10 text-center text-gray-300">Atualize as Quantidades</h2>

    <section id="infantil-edit" class="py-10">
      <h2 class="font-display text-3xl font-bold text-white border-b-2 border-blue-600 inline-block pb-2 mb-8">EducaÃ§Ã£o Infantil</h2>
      <div id="infantil-grid-edit" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </section>
    <section id="fundamental1-2-edit" class="py-10">
      <h2 class="font-display text-3xl font-bold text-white border-b-2 border-blue-600 inline-block pb-2 mb-8">Fundamental I: 1Âº e 2Âº Ano</h2>
      <div id="fundamental1-2-grid-edit" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </section>
    <section id="fundamental3-5-edit" class="py-10">
      <h2 class="font-display text-3xl font-bold text-white border-b-2 border-blue-600 inline-block pb-2 mb-8">Fundamental I: 3Âº ao 5Âº Ano</h2>
      <div id="fundamental3-5-grid-edit" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </section>

    <div class="mt-12 pt-8 border-t border-slate-700 text-center">
      <button id="salvar" class="inline-flex items-center gap-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-10 py-4 rounded-xl font-semibold text-lg transition-all duration-300 ease-in-out transform hover:scale-105 shadow-lg hover:shadow-green-500/30">
        ðŸ’¾ Salvar AlteraÃ§Ãµes
      </button>
      <p id="mensagem" class="text-sm mt-4 transition-opacity opacity-0"></p>
    </div>
  </main>

  <script>
    function criarCardProduto(produto) {
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <div>
          <h3 class="font-display text-xl font-semibold mb-2">${produto.nome}</h3>
          <div class="status-indicator"></div>
        </div>
        <div class="mt-4 border-t border-slate-700 pt-3">
          <p class="text-gray-400 text-sm mb-1">Estoque Atual</p>
          <p class="text-2xl font-bold">${produto.em_estoque}</p>
        </div>
      `;
      updateFixedStatus(card, produto.em_estoque);
      return card;
    }

    function updateFixedStatus(card, estoque) {
      const indicator = card.querySelector('.status-indicator');
      if (estoque > 100) indicator.classList.add('status-tranquilo'), indicator.textContent = 'Tranquilo';
      else if (estoque > 50) indicator.classList.add('status-alerta-fixo'), indicator.textContent = 'Alerta';
      else if (estoque > 0) indicator.classList.add('status-preocupante'), indicator.textContent = 'Preocupante';
      else indicator.classList.add('status-vazio'), indicator.textContent = 'Estoque Vazio';
    }

    function criarCardEditHTML(p) {
      return `
        <div class="edit-card">
          <div class="flex justify-between items-start mb-2">
            <h2 class="font-display text-lg font-semibold">${p.nome}</h2>
            <span class="status-badge ${getStatusClass(p.em_estoque)}">${getStatusText(p.em_estoque)}</span>
          </div>
          <label class="block text-sm text-gray-400 mb-2">Quantidade</label>
          <input type="number" min="0" value="${p.em_estoque}" data-id="${p.id}" class="w-full text-center text-xl font-bold rounded-md bg-slate-800 border border-slate-600 py-2">
        </div>
      `;
    }

    function getStatusClass(v){if(v>100)return'bg-green-600';if(v>50)return'bg-yellow-400 text-gray-900';if(v>0)return'bg-orange-500';return'bg-red-600';}
    function getStatusText(v){if(v>100)return'Tranquilo';if(v>50)return'Alerta';if(v>0)return'Preocupante';return'Estoque Vazio';}

    async function carregarProdutos(){
      const res = await fetch('/api/produtos');
      const produtos = await res.json();

      const gridsView = {
        infantil: document.getElementById('infantil-grid'),
        'fundamental1-2': document.getElementById('fundamental1-2-grid'),
        'fundamental3-5': document.getElementById('fundamental3-5-grid'),
      };
      const gridsEdit = {
        infantil: document.getElementById('infantil-grid-edit'),
        'fundamental1-2': document.getElementById('fundamental1-2-grid-edit'),
        'fundamental3-5': document.getElementById('fundamental3-5-grid-edit'),
      };
      Object.values({...gridsView,...gridsEdit}).forEach(g=>g.innerHTML='');

      produtos.forEach(p=>{
        const card = criarCardProduto(p);
        const cardEdit = criarCardEditHTML(p);
        if(gridsView[p.categoria]) gridsView[p.categoria].appendChild(card);
        if(gridsEdit[p.categoria]) gridsEdit[p.categoria].innerHTML += cardEdit;
      });
    }

    async function salvarAlteracoes(){
      const inputs=document.querySelectorAll('#editar input[type="number"]');
      const dados=[...inputs].map(i=>({id:parseInt(i.dataset.id),emEstoque:parseInt(i.value),necessario:0}));
      const res=await fetch('/api/atualizar',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(dados)});
      const result=await res.json();
      const msg=document.getElementById('mensagem');
      msg.textContent=result.mensagem;
      msg.classList.remove('opacity-0');
      msg.classList.add('text-green-400');
      setTimeout(()=>msg.classList.add('opacity-0'),3000);
      carregarProdutos();
    }

    document.addEventListener('DOMContentLoaded',()=>{
      carregarProdutos();
      document.getElementById('salvar').addEventListener('click',salvarAlteracoes);
      const visualizar=document.getElementById('visualizar');
      const editar=document.getElementById('editar');
      document.getElementById('tab-visualizar').addEventListener('click',()=>{
        visualizar.classList.remove('hidden'); editar.classList.add('hidden');
      });
      document.getElementById('tab-editar').addEventListener('click',()=>{
        editar.classList.remove('hidden'); visualizar.classList.add('hidden');
      });
    });
  </script>
</body>
</html>
