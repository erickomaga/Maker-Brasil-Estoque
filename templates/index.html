<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Controle de Estoque - Maker Brasil</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'sans': ['Inter', 'sans-serif'],
            'display': ['Montserrat', 'sans-serif'],
          }
        }
      }
    }
  </script>

  <style>
    body {
      background-color: #0f172a; 
      color: #e2e8f0;
    }

    .product-card {
      background-color: #1e293b; 
      border-radius: 1rem;
      border: 1px solid #334155;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .product-card:hover {
      transform: translateY(-5px);
      border-color: #3b82f6; 
      box-shadow: 0 0 25px rgba(59, 130, 246, 0.2);
    }
    .product-title {
      font-family: 'Montserrat', sans-serif; 
      font-size: 1.25rem; 
      font-weight: 600; 
      margin-bottom: 0.75rem; 
      color: #e2e8f0; 
    }
    .status-wrapper {
      text-align: center;
      margin-bottom: 1rem;
    }
    .stock-info {
      margin-top: 1rem; 
      padding-top: 1rem;
      border-top: 1px solid #334155; 
    }
    .stock-label {
      font-size: 0.875rem; 
      color: #94a3b8;
      margin-bottom: 0.25rem; 
    }
    .stock-value {
      font-size: 1.875rem; 
      font-weight: 700; 
      color: #ffffff; 
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.4rem 0.8rem;
      border-radius: 9999px;
      font-size: 0.85rem;
      font-weight: 700;
      color: white;
      text-align: center;
      transition: all 0.3s ease;
    }
    .status-tranquilo { background-color: #16a34a; } 
    .status-alerta-fixo { background-color: #f59e0b; color: #1e293b; } 
    .status-preocupante { background-color: #f97316; } 
    .status-vazio { background-color: #dc2626; } 
  </style>
</head>

<body class="font-sans antialiased pb-24">
  <header class="bg-slate-900/80 backdrop-blur-lg sticky top-0 z-50 shadow-lg shadow-black/30">
    <div class="container mx-auto max-w-7xl px-6 py-4 flex justify-between items-center">
      <h1 class="font-display text-3xl font-bold text-white">Gestão de Estoque</h1>
      <nav class="hidden md:flex items-center space-x-8">
        <a href="#infantil" class="text-gray-300 hover:text-blue-400 transition-colors">Educação Infantil</a>
        <a href="#fundamental1-2" class="text-gray-300 hover:text-blue-400 transition-colors">Fundamental I (1º-2º)</a>
        <a href="#fundamental3-5" class="text-gray-300 hover:text-blue-400 transition-colors">Fundamental I (3º-5º)</a>
      </nav>
      <a href="editar.html" 
         class="inline-flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold px-5 py-2.5 rounded-lg transition-all duration-300 ease-in-out transform hover:scale-105 shadow-md hover:shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
        </svg>
        Editar Estoque
      </a>
    </div>
  </header>

  <main class="container mx-auto max-w-7xl px-6 py-12">
    <section id="infantil" class="py-16">
      <div class="text-center mb-12">
        <h2 class="font-display text-4xl font-bold text-white border-b-2 border-blue-600 inline-block pb-2">Educação Infantil</h2>
        <p class="text-lg text-gray-400 mt-4">Kits e materiais para os pequenos.</p>
      </div>
      <div id="infantil-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </section>

    <section id="fundamental1-2" class="py-16 bg-slate-800/20 rounded-3xl">
      <div class="text-center mb-12">
        <h2 class="font-display text-4xl font-bold text-white border-b-2 border-blue-600 inline-block pb-2">Fundamental I: 1º e 2º Ano</h2>
        <p class="text-lg text-gray-400 mt-4">Materiais para o ciclo inicial.</p>
      </div>
      <div id="fundamental1-2-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8 px-8"></div>
    </section>

    <section id="fundamental3-5" class="py-16">
      <div class="text-center mb-12">
        <h2 class="font-display text-4xl font-bold text-white border-b-2 border-blue-600 inline-block pb-2">Fundamental I: 3º ao 5º Ano</h2>
        <p class="text-lg text-gray-400 mt-4">Materiais para o ciclo intermediário.</p>
      </div>
      <div id="fundamental3-5-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </section>
  </main>

  <script>
    function criarCardProduto(produto) {
      const card = document.createElement("div");
      card.className = "product-card"; 
      
      card.innerHTML = `
        <div>
          <h3 class="product-title">${produto.nome}</h3>
          <div class="status-wrapper">
            <div class="status-indicator"></div>
          </div>
        </div>
        <div class="stock-info">
            <p class="stock-label">Estoque Atual</p>
            <p class="stock-value">${produto.em_estoque}</p>
        </div>
      `;
      updateFixedStatus(card, produto.em_estoque);
      return card;
    }

    function updateFixedStatus(card, estoque) {
      const indicator = card.querySelector(".status-indicator");
      indicator.className = "status-indicator";

      if (estoque > 100) {
        indicator.classList.add("status-tranquilo");
        indicator.textContent = "Tranquilo";
      } else if (estoque > 50) {
        indicator.classList.add("status-alerta-fixo");
        indicator.textContent = "Alerta";
      } else if (estoque > 0) {
        indicator.classList.add("status-preocupante");
        indicator.textContent = "Preocupante";
      } else {
        indicator.classList.add("status-vazio");
        indicator.textContent = "Estoque Vazio";
      }
    }

    async function carregarProdutosDaAPI() {
      const grids = {
        infantil: document.getElementById("infantil-grid"),
        "fundamental1-2": document.getElementById("fundamental1-2-grid"),
        "fundamental3-5": document.getElementById("fundamental3-5-grid"),
      };

      try {
        const res = await fetch('/api/produtos');
        if (!res.ok) throw new Error('Falha ao carregar produtos');
        const produtos = await res.json();

        Object.values(grids).forEach(grid => grid.innerHTML = '');

        produtos.forEach((produto) => {
          const card = criarCardProduto(produto);
          if (grids[produto.categoria]) {
            grids[produto.categoria].appendChild(card);
          } else {
            console.warn(`Categoria desconhecida: ${produto.categoria} para o produto ${produto.nome}`);
          }
        });
      } catch (error) {
        console.error('Erro ao carregar produtos:', error);
      }
    }

    document.addEventListener("DOMContentLoaded", carregarProdutosDaAPI);
  </script>
</body>
</html>